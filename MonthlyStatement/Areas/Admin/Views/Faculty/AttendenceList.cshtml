@model IEnumerable<MonthlyStatement.Models.Profile>
@{
    int i = 0;
}
@{
    ViewBag.Title = "AttendenceList";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="section">
    <div class="section-body">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary" style="height:100px">
                        <h4 class="text-white" style="font-size:1.75rem">Danh sách thành viên</h4>
                        <div class="card-header-form">
                            <form>
                                <div class="input-group">
                                    <input class="form-control" type="text" id="Search" placeholder="Tìm kiếm" aria-label="Search" data-width="200" style="width: 200px;">
                                    <div class="input-group-btn">
                                        <button class="btn btn-primary"><i class="fas fa-search"></i></button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="card-body">

                    <div class="form-group">
                        <div class="col-sm-12 buttons">
                            <a style="color:white" type="button" class="btn btn-primary btn-round" href="#">
                                <i class="fa fa-plus"></i>
                                Thêm thành viên
                            </a>
                            <a style="color:white" class="btn btn-warning btn-round" href="#" type="button" data-toggle="modal"
                               data-target="#exampleModalCenter">
                                <i class="fa fa-plus"></i>
                                Import
                            </a>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped" id="table-1">
                            <thead>
                                <tr>
                                    <th class="text-center">
                                        #
                                    </th>
                                    <th>Task Name</th>
                                    <th>Progress</th>
                                    <th>Members</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        1
                                    </td>
                                    <td>Create a mobile app</td>
                                    <td class="align-middle">
                                        <div class="progress progress-xs">
                                            <div class="progress-bar bg-success width-per-40">
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <img alt="image" src="assets/img/users/user-5.png" width="35">
                                    </td>
                                    <td>2018-01-20</td>
                                    <td>
                                        <div class="badge badge-success badge-shadow">Completed</div>
                                    </td>
                                    <td><a href="#" class="btn btn-primary">Detail</a></td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalCenterTitle">Thêm danh sách người dùng</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="fileimport">
                    <label class="custom-file-label" for="customFile">Chọn file danh sách (xls/xlsx)</label>
                </div>
                <p id="importfilevalidation" hidden="hidden" class="text-danger"></p>
            </div>
            <div class="modal-footer bg-whitesmoke br">
                <button type="button" class="btn btn-primary" id="importUser">Save</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script>
    $(document).ready(function () {
        function Contains(text_one, text_two) {
            if (text_one.indexOf(text_two) != -1)
                return true;
        }
        $("#Search").keyup(function () {
            var searchText = $("#Search").val().toLowerCase();
            $(".Search").each(function () {
                if (!Contains($(this).text().toLowerCase(), searchText)) {
                    $(this).hide();
                }
                else {
                    $(this).show();
                }
            });
        });
        $('#importUser').on('click', function () {
            $('#importfilevalidation').hide();
            let fileimport = $('#fileimport').val();
            let fileType = fileimport.substr(fileimport.lastIndexOf('.') + 1).toLowerCase();

            if (fileimport.trim().length < 1) {
                $('#importfilevalidation').text("Bạn chưa chọn file, Hãy chọn file danh sách cần nhập.").show().prop("hidden", false);
            } else if (fileType != "xlsx" && fileType != "xls") {
                $('#importfilevalidation').text("File không đúng định dạng, Vui lòng chọn file có định dạng .xls/.xlsx.").show().prop("hidden", false);
            }
            else {
                var formData = new FormData();
                formData.append('lstUser', $("#fileimport")[0].files[0]);

                $('#AjaxLoader').show();
                $.ajax({
                    url: $('#requestPath').val() + 'Faculty/ImportUser',
                    type: 'POST',
                    dataType: 'html',
                    contentType: false,
                    processData: false,
                    data: formData
                }).done(function (ketqua) {
                    $('#fileimport').val(null);
                    if (ketqua == "INCORRECT") {
                        $('#AjaxLoader').hide();
                        var SweetAlert2Demo = function () {
                            var initDemos = function () {
                                swal("Thông báo!", "Dữ liệu file được nhập chưa đúng,\nvui lòng kiểm tra và thực hiện lại.", {
                                    icon: "error",
                                    buttons: {
                                        confirm: {
                                            className: 'btn btn-danger'
                                        }
                                    },
                                });
                            };
                            return {
                                init: function () {
                                    initDemos();
                                },
                            };
                        }();

                        jQuery(document).ready(function () {
                            SweetAlert2Demo.init();
                        });
                    }
                    else if (ketqua == "DANHSACH") {
                        $('#AjaxLoader').hide();
                        window.location.href = $('#requestPath').val() + "admins/quanlynhansu/danhsachnhanvien";
                    }
                    else {
                        $('#lstTempDataEmployee').replaceWith(ketqua);
                        $('#AjaxLoader').hide();
                        $('#openListEmployeeTemp').click();

                        $.when(
                            $.getScript($('#requestPath').val() + "Content/Admin/assets/js/plugin/sweetalert/sweetalert.min.js"),
                            $.getScript($('#requestPath').val() + "Content/Admin/assets/js/theme.min.js"),

                            $.Deferred(function (deferred) {
                                $(deferred.resolve);
                            })
                        ).done(function () {
                        });
                    }
                });
            }
        });
    });
</script>
